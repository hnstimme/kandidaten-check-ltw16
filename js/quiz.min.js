var currentQuestionID=0,currentQuestionOrderID=0,currentQuestion,questionOrder=[],selections=[],selectedWahlkreis,picked,quiz_data,numberOfQuestions,numberOfChallenges=0,candidates,aspectRatio,headerImg,privateResult,politicalResult,lastWindowWidth;$(document).ready(function(){function e(){0!=questionOrder.length;for(var e=0;numberOfQuestions>e;e++)questionOrder.push(e);g(questionOrder);for(var i=0;numberOfChallenges>i;i++){var n=Math.round((numberOfQuestions+numberOfChallenges)/(i+1)-1);questionOrder.splice(n,0,numberOfQuestions+numberOfChallenges-i-1)}}function i(e,i,n){Circles.create({id:i,radius:n,value:e,width:3,text:"",colors:["white","#D05C5C"],duration:400})}function n(e,n){var t=100;t=$(window).width()>460?100:70,i(e,"politicalCandidate",t),i(n,"privateCandidate",t)}function t(e,i){$(".progress .currentProgress").css("width",(e-1)/i*100+"%"),$(".progress .progresstext").html("Frage "+e+" von "+i)}function s(e){var i=$(e).outerWidth(),n=Math.round(i/aspectRatio)-1;$(e).css("height",n)}function a(){$(".question > h3").empty(),$(".tiles .tile").remove(),$("button.nextQuestion").remove(),$.each(quiz_data,function(i,n){i===selectedWahlkreis&&(0==questionOrder.length&&(numberOfQuestions=n.length,$.each(n,function(e,i){"challenge"==i.typ&&numberOfChallenges++}),numberOfQuestions-=numberOfChallenges,e()),-1!=currentQuestionOrderID?(currentQuestionID=questionOrder[currentQuestionOrderID],numberOfQuestions+numberOfChallenges>currentQuestionOrderID?(r(n),t(currentQuestionOrderID+1,numberOfChallenges+numberOfQuestions),$(window).width()<500&&$("html, body").animate({scrollTop:$(".progress").offset().top},100)):u()):h("question")),$(".tiles").randomize(".tile")})}function r(e){if($.each(e,function(e,i){i.id==currentQuestionID&&($(".question > h3").text(i.frage),currentQuestion=i);var n=0;$.each(i.antworten,function(e,t){if(i.id==currentQuestionID)if("challenge"!=i.typ){var s='<div class="tile" data-index="'+n+'"><span class="logo answer"></span><div class="title">'+t+"</div></div>";t.length<60&&(s='<div class="tile" data-index="'+n+'"><span class="logo answer"></span><div class="title" style="text-align: center;">'+t+"</div></div>"),$(".tiles").append(s),n+=1}else if("challenge"==i.typ){var s='<div class="tile" data-index="'+n+'"><img class="challenge" src="img/challenges/'+t+'"></div>';$(".tiles").append(s),n+=1}})}),currentQuestionOrderID in selections){var i=+selections[currentQuestionOrderID][0],n=$(".tile").eq(i);l(n)}}function l(e){$(".tile").removeClass("picked"),$(".tile").removeClass("blind"),$(e).addClass("picked"),$(".tile:not(.picked)").addClass("blind")}function d(e,i){for(var n,t=0,s=0,a=[],r=0;4>r;r++){for(var l=0;l<selections.length;l++)void 0!=typeof i&&(selections[l][1]===e||selections[l][1]===i?(s++,selections[l][0]==r&&t++):selections[l][1]===e&&(s++,selections[l][0]==r&&t++)),selections[l][1]===e&&(s++,selections[l][0]==r&&t++);n=Math.round(t/(s/(r+1))*100),a.push([r,n]),t=0}return a.sort(function(e,i){return e[1]>i[1]?-1:e[1]===i[1]?0:1}),a}function o(e,i){var n={};return $.each(candidates,function(t,s){$.each(s,function(s,a){t==e&&a.id==i&&(n=a)})}),n}function c(e){$("."+e).addClass("question").removeClass(e),$(".tiles").empty(),$(".tile-grid .previousQuestion").replaceWith('<button class="previousQuestion"><img class="twisted" src="img/next.svg"></button>'),$(".progress").show(),$(".issues h2 > span").html(selectedWahlkreis),$(".issues p").hide(),currentQuestionOrderID=0,a()}function h(e){$("."+e).addClass("wahlkreis").removeClass(e),$(".issues p").show(),$(".issues h2 > span").show().html("Wahlkreis wählen"),$(".issues p").show().html("Für unseren Kandidaten-Check haben die Landtagskandidaten von CDU, Grünen, SPD und FDP persönliche und politische Fragen beantwortet. Die Highlights haben wir ausgewählt. Klicken Sie jeweils auf die Antwort, die Ihnen am besten gefällt. Am Ende erfahren Sie, mit welchem Kandidaten Sie – politisch und privat – am meisten Übereinstimmungen haben."),$(".tile-grid").empty(),$(".tile-grid").append('<div class="waitForTheButton previousQuestion"></div>'),$(".tile-grid").append('<div class="tiles"></div>'),$(".tiles").append('<div class="tile" id="Eppingen"><span class="logo"><span>EP</span></span><div class="title">Eppingen</div></div>'),$(".tiles").append('<div class="tile" id="Heilbronn"><span class="logo"><span>HN</span></span><div class="title">Heilbronn</div></div>'),$(".tiles").append('<div class="tile" id="Neckarsulm"><span class="logo"><span>NSU</span></span><div class="title">Neckarsulm</div></div>'),$(".tiles").append('<div class="tile" id="Hohenlohe"><span class="logo"><span>HOH</span></span><div class="title">Hohenlohe</div></div>'),$(".tiles").after('<div class="waitForTheButton nextQuestion"></div>'),$(".wahlkreis h3").show().html("Wählen Sie Ihren Wahlkreis"),$(".progress").hide(),currentQuestionID=0,questionOrder=[]}function u(){$(".question").addClass("personal-result").removeClass("question"),$(".issues h2 > span").html("Ihr Ergebnis"),$(".wahlkreis h3").hide(),$(".personal-result > h3").hide(),$(".tile-grid").remove(),$(".progress").hide(),privateResult=d("privat","challenge"),politicalResult=d("politisch");for(var e=0;4>e;e++){var i=o(selectedWahlkreis,privateResult[e][0]),t=o(selectedWahlkreis,politicalResult[e][0]);0==$(".candidates").length?$(".personal-result > h3").after('<div class="candidates"></div>'):$(".candidates:last-of-type").after('<div class="candidates"></div>'),$(".candidates:last-of-type").append('<div class="candidate"></div>'),$(".candidates:last-of-type .candidate:first-of-type").html('<div class="percentage"><div class="chart" id="politicalCandidate"></div><div class="picture"></div></div><p class="info">'+t.kandidaten_name+", "+t.partei+", "+t.alter+" Jahre</p><h2>"+politicalResult[e][1]+"%</h2>"),$(".candidates:last-of-type").append('<div class="candidate"></div>'),$(".candidates:last-of-type .candidate:last-of-type").html('<div class="percentage"><div class="chart" id="privateCandidate"></div><div class="picture"></div></div><p class="info">'+i.kandidaten_name+", "+i.partei+", "+i.alter+" Jahre</p><h2>"+privateResult[e][1]+"%</h2>"),$(".candidates:last-of-type .candidate:first-of-type .picture").css("background-image",'url("img/kandidaten/'+t.bild_url+'")'),$(".candidates:last-of-type .candidate:last-of-type .picture").css("background-image",'url("img/kandidaten/'+i.bild_url+'")')}n(politicalResult[0][1],privateResult[0][1]),$(".candidates:first-of-type .candidate:first-of-type .percentage").before('<div class="topic">Politisch</div>'),$(".candidates:first-of-type .candidate:last-of-type .percentage").before('<div class="topic">Privat</div>');var i=o(selectedWahlkreis,privateResult[0][0]),t=o(selectedWahlkreis,politicalResult[0][0]);$(".personal-result").after('<div class="sharing-container"><ul></ul></div>'),$(".sharing-container ul").append('<li><a href="https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Fwww.stimme.de%2Fkandidatencheck" target="_blank" ><img src="img/facebook.png" alt="Facebook Share Icon"></a></li><li><a href="https://twitter.com/intent/tweet?text=Ich%20habe%20den%20%23KandidatenCheck%20von%20%40stimmeonline%20gecheckt!%20%23ltwbw%20Erfahre%2C%20welcher%20Landtagskandidat%20zu%20dir%20passt%3A%20&url=http%3A%2F%2Fwww.stimme.de%2Fkandidatencheck" target="_blank"><img src="img/twitter.png" alt="Twitter Share Icon"></a></li>');var s;s=i.kandidaten_name==t.kandidaten_name?'<li id="whatsapp-sharing" style="display: none;"><a href="whatsapp://send?text=Mein%20Ergebnis%20beim%20Kandidaten-Check%3A%20'+encodeURIComponent(t.kandidaten_name)+'%20passt%20politisch%20und%20pers%C3%B6nlich%20am%20besten%20zu%20mir.%20Welcher%20Politiker%20aus%20deinem%20Wahlkreis%20dir%20am%20%C3%A4hnlichsten%20ist%2C%20erf%C3%A4hrst%20du%20unter%3A%20www.stimme.de%2Fkandidatencheck"><img src="img/whatsapp.png" alt="WhatsApp Share Icon"></a></li>':'<li id="whatsapp-sharing" style="display: none;"><a href="whatsapp://send?text=Mein%20Ergebnis%20beim%20Kandidaten-Check%3A%20'+encodeURIComponent(t.kandidaten_name)+"%20passt%20politisch%20und%20"+encodeURIComponent(i.kandidaten_name)+'%20pers%C3%B6nlich%20am%20besten%20zu%20mir.%20Welcher%20Politiker%20aus%20deinem%20Wahlkreis%20dir%20am%20%C3%A4hnlichsten%20ist%2C%20erf%C3%A4hrst%20du%20unter%3A%20www.stimme.de%2Fkandidatencheck"><img src="img/whatsapp.png" alt="WhatsApp Share Icon"></a></li>',$(".sharing-container ul").append(s),/Android|webOS|iPhone|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)&&$("#whatsapp-sharing").css("display","inline");var a="";a="Eppingen"!=selectedWahlkreis?"Geschafft! Jetzt erfahren Sie, die Antworten welches Kandidaten Sie am häufigsten ausgewählt haben, und welche am seltensten. Auf der linken Seite sehen Sie die politische Übereinstimmung. Auf der rechten Seite sehen Sie, welcher Kandidat Ihnen persönlich am nächsten steht. Antworten zu persönlichen Vorlieben und die Zeichnungen und Bilder zählen als persönliche Übereinstimmung.  Gleiche Antworten auf Sachfragen wurden als politische Übereinstimmung gewertet.":"Geschafft! Jetzt erfahren Sie, die Antworten welches Kandidaten Sie am häufigsten ausgewählt haben, und welche am seltensten. Auf der linken Seite sehen Sie die politische Übereinstimmung. Gleiche Antworten auf Sachfragen wurden als politische Übereinstimmung gewertet. Auf der rechten Seite sehen Sie, welcher Kandidat Ihnen persönlich am nächsten steht. Gleiche Antworten zu persönlichen Vorlieben zählen als persönliche Übereinstimmung. In den anderen Wahlkreisen in der Region haben die Politiker drei Zusatzaufgaben wie kuriose Selfies und eine Zeichnung eingeschickt, die Kandidaten aus Eppingen wollten das nicht. Schade!",$(".issues p").show().html(a);var r="Für den Kandidaten-Check haben Volontäre der Heilbronner Stimme die Kandidaten zur Landtagswahl nach Persönlichem und Politischem befragt. Eine Auswahl der Antworten und die Zusatzaufgaben haben es in den Check geschafft.</p><p>Am Projekt beteiligt waren: Henri Chilla, Ranjo Doering, Janis Dietz, Christoph Feil, David Hilzendegen, Felix Klingel, Heiko Nicht, Kirsi-Fee Rexin, Daniel Stahl, Franziska Türk, Katrin Walter, Samantha Walther und Bianca Zäuner</p><p>Wir danken den Politikern, dass sie sich – mehrheitlich – auf diese etwas andere Interviewform eingelassen haben.</p>";$(".sharing-container").before('<section class="credits"><h3>Credits</h3><p>'+r+"</section>"),$(".credits").before('<div class="moreAction"><a class="restartGame">Zurück zum Start</a><a class="wahlkreis" href="http://www.stimme.de/themen/wahlen/landtagswahl2016/'+selectedWahlkreis+'">Mehr Infos zum Wahlkreis '+selectedWahlkreis+"</a></div>")}function p(){$(".personal-result").empty(),$(".personal-result").append("<h3></h3>"),$(".personal-result").append('<div class="tile-grid"></div>'),$("div.moreAction").remove(),$(".endingText").remove(),$(".credits").remove(),$(".sharing-container").remove(),selectedWahlkreis=null,currentQuestionID=0,currentQuestionOrderID=0,politicalResult=null,privateResult=null,selections=[],h("personal-result")}function m(){$.getJSON("js/quiz.json",function(e){quiz_data=e}),$.getJSON("js/candidates.json",function(e){candidates=e}),headerImg=new Image,headerImg.onload=function(){aspectRatio=this.width/this.height,s("header")},headerImg.src="img/header_bg.jpg",lastWindowWidth=$(window).width()}function g(e){for(var i,n,t=e.length;0!==t;)n=Math.floor(Math.random()*t),t-=1,i=e[t],e[t]=e[n],e[n]=i;return e}$("section").on("click","button.previousQuestion",function(){0!=$(".question").length&&(currentQuestionOrderID-=1,a())}),$("body").on("click",".wahlkreis .tile",function(){selectedWahlkreis=$(this).attr("id"),c("wahlkreis")}),$("body").on("click",".question .tile",function(){picked=$(this).attr("data-index"),l(this),0!=$(".question").length&&(selections[currentQuestionOrderID]=new Array,selections[currentQuestionOrderID].push(picked,currentQuestion.typ),currentQuestionOrderID+=1,a(),picked=null)}),$("section").on("click","button.nextQuestion",function(){c("wahlkreis")}),$("div").on("click","div.moreAction a.restartGame",function(){p()}),$("section").on("mouseenter mouseleave",".tile",function(){l(this)}),$("section").on("mouseleave",".tiles",function(){if(currentQuestionOrderID in selections){var e=$(".tile[data-index="+selections[currentQuestionOrderID][0]+"]");l(e)}else("undefined"==typeof picked||null==picked)&&($(".tile").removeClass("picked"),$(".tile").removeClass("blind"))}),m(),$(window).resize(function(){s("header"),null!=politicalResult&&(lastWindowWidth>=460&&$(window).width()<=460||460>=lastWindowWidth&&$(window).width()>=460)&&n(politicalResult[0][1],privateResult[0][1]),lastWindowWidth=$(window).width()}),$.fn.randomize=function(e){return(e?this.find(e):this).parent().each(function(){$(this).children(e).sort(function(){return Math.random()-.5}).detach().appendTo(this)}),this}});